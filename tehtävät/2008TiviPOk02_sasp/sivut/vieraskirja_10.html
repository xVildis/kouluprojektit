  <!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Vieraskirja (10)</title>
	<LINK REL=stylesheet type="text/css" href="style.css">
</head>

<script type="text/javascript" src="header2.js"> </script>
<div id="sisalto">

<h1>10. Toteuta tietojen haku ylläpitonäkymässä</h1>
<ol>
<li><a href="vieraskirja_1.html">tehtävä</a></li>
<li><a href="vieraskirja_2.html">suunnitelma</a></li>
<li><a href="vieraskirja_3.html">tietokannan toteutus</a></li>
<li><a href="vieraskirja_4.html">käyttöliittymä</a></li>
<li><a href="vieraskirja_5.html">runko järjestelmään</a></li>
<li><a href="vieraskirja_6.html">tietojen lisäys lukijan näkymässä</a></li>
<li><a href="vieraskirja_7.html">autentikointi</a></li>
<li><a href="vieraskirja_8.html">jutun lisäys ylläpitonäkymässä</a></li>
<li><a href="vieraskirja_9.html">tietojen haku lukijan näkymässä</a></li>
<li><a href="vieraskirja_10.html">tietojen haku ylläpitonäkymässä</a></li>
<li><a href="vieraskirja_11.html">lisäykset</a></li>

</ol>
<h2>Tämän tunnin tavoite</h2>
<p>Tunnin tavoite on rakentaa kaikki ylläpidon näkymän sivut (admin_etusivu.php, muokkaa_juttua.php ja muokkaa_omia_tietoja.php).</p>

<h3>./sisalto/admin_etusivu.php</h3>
<p>Etusivulle tulostetaan kaikki kirjautuneen käyttäjän jutut kuvaruudulle. Kirjautuneen käyttäjän kid haetaan istuntomuuttujasta $_SESSION["kid"].</p>
<p>Tallenna tiedosto kansioon sisalto.</p>

<p class="koodi">
<code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php
<br /></span><span style="color: #FF8000">/*&nbsp;Ohjelma&nbsp;tulostaa&nbsp;yhden&nbsp;kirjoittajan&nbsp;jutut&nbsp;tietokannasta&nbsp;ja&nbsp;lisää&nbsp;jutun&nbsp;perään&nbsp;linkit&nbsp;"Muokkaa&nbsp;juttua"&nbsp;ja&nbsp;Poista&nbsp;juttu"*/
<br />
<br /></span><span style="color: #0000BB">$kid</span><span style="color: #007700">=</span><span style="color: #DD0000">""</span><span style="color: #007700">;
<br />if(isset(</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">"kid"</span><span style="color: #007700">]))&nbsp;</span><span style="color: #0000BB">$kid</span><span style="color: #007700">=</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">"kid"</span><span style="color: #007700">];
<br /></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;juttu&nbsp;WHERE&nbsp;kid='</span><span style="color: #0000BB">$kid</span><span style="color: #DD0000">'&nbsp;ORDER&nbsp;BY&nbsp;lisayspvm&nbsp;desc"</span><span style="color: #007700">;
<br />
<br />require&nbsp;</span><span style="color: #DD0000">"./tietokanta/yhteys.php"</span><span style="color: #007700">;
<br /></span><span style="color: #0000BB">$kysely</span><span style="color: #007700">=</span><span style="color: #0000BB">$yhteys</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);
<br />
<br /></span><span style="color: #0000BB">$rivit&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$kysely</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rowCount</span><span style="color: #007700">();
<br /></span><span style="color: #0000BB">$vastaus&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$kysely</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">);&nbsp;
<br />for(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;</span><span style="color: #0000BB">$i</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">$rivit</span><span style="color: #007700">;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$jid</span><span style="color: #007700">=</span><span style="color: #0000BB">$vastaus</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">][</span><span style="color: #DD0000">"jid"</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$lisayspvm</span><span style="color: #007700">=</span><span style="color: #0000BB">$vastaus</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">][</span><span style="color: #DD0000">"lisayspvm"</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$otsikko</span><span style="color: #007700">=</span><span style="color: #0000BB">$vastaus</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">][</span><span style="color: #DD0000">"otsikko"</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kpl</span><span style="color: #007700">=</span><span style="color: #0000BB">$vastaus</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">][</span><span style="color: #DD0000">"kpl"</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kid</span><span style="color: #007700">=</span><span style="color: #0000BB">$vastaus</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">][</span><span style="color: #DD0000">"kid"</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kirjoittaja</span><span style="color: #007700">=</span><span style="color: #0000BB">kayttajan_nimi</span><span style="color: #007700">(</span><span style="color: #0000BB">$kid</span><span style="color: #007700">,</span><span style="color: #0000BB">$yhteys</span><span style="color: #007700">);
<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;h1&gt;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$otsikko</span><span style="color: #007700">.</span><span style="color: #DD0000">"&lt;/h1&gt;\n"</span><span style="color: #007700">;
<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;p&gt;</span><span style="color: #0000BB">$lisayspvm</span><span style="color: #DD0000">&lt;/p&gt;"</span><span style="color: #007700">;
<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;a&nbsp;href=\"admin.php?sivu=muokkaa_juttua&amp;jid=</span><span style="color: #0000BB">$jid</span><span style="color: #DD0000">&amp;mode=muokkaa\"&gt;Muokkaa&nbsp;juttua&nbsp;&lt;/a&gt;&lt;br&gt;\n"</span><span style="color: #007700">;
<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;a&nbsp;href=\"admin.php?sivu=muokkaa_juttua&amp;jid=</span><span style="color: #0000BB">$jid</span><span style="color: #DD0000">&amp;mode=poista\"&gt;Poista&nbsp;juttu&lt;/a&gt;&lt;hr&gt;\n"</span><span style="color: #007700">;
<br />}&nbsp;</span><span style="color: #0000BB">?&gt;</span>
</span>
</code></p>


<h3>./sisalto/muokkaa_juttua.php</h3>
<p>Sivulle tullaan klikkamalla etusivulta linkkiä "Muokkaa". Kirjautuneen käyttäjän kid haetaan istuntomuuttujasta $_SESSION["kid"].</p>
<p>Tallenna tiedosto kansioon sisalto.</p>

<p class="koodi">
<code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php
<br /></span><span style="color: #FF8000">/******************
<br />Taulun&nbsp;rakenne
<br />jid&nbsp;int(6)&nbsp;auto_increment&nbsp;(on&nbsp;siis&nbsp;autonumber&nbsp;tai&nbsp;laskuri-tyyppinen),&nbsp;pääavain
<br />otsikko&nbsp;varchar(100)
<br />kpl&nbsp;text
<br />poistamispvm&nbsp;date&nbsp;NOT&nbsp;NULL
<br />lisayspvm&nbsp;date
<br />kid&nbsp;int(6)
<br />**********************/
<br /></span><span style="color: #007700">require&nbsp;</span><span style="color: #DD0000">"./tietokanta/yhteys.php"</span><span style="color: #007700">;
<br />if(isset(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">"jid"</span><span style="color: #007700">]))&nbsp;</span><span style="color: #0000BB">$jid</span><span style="color: #007700">=</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">"jid"</span><span style="color: #007700">];
<br />else&nbsp;</span><span style="color: #0000BB">$jid</span><span style="color: #007700">=</span><span style="color: #DD0000">""</span><span style="color: #007700">;
<br />
<br />if(isset(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">"mode"</span><span style="color: #007700">]))&nbsp;</span><span style="color: #0000BB">$mode</span><span style="color: #007700">=</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">"mode"</span><span style="color: #007700">];
<br />else&nbsp;</span><span style="color: #0000BB">$mode</span><span style="color: #007700">=</span><span style="color: #DD0000">"muokkaa"</span><span style="color: #007700">;
<br />if(</span><span style="color: #0000BB">$mode</span><span style="color: #007700">==</span><span style="color: #DD0000">"poista"</span><span style="color: #007700">)
<br />{
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sql</span><span style="color: #007700">=</span><span style="color: #DD0000">"DELETE&nbsp;FROM&nbsp;juttu&nbsp;WHERE&nbsp;jid=?"</span><span style="color: #007700">;&nbsp;
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kysely&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$yhteys</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);&nbsp;
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kysely</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(array(</span><span style="color: #0000BB">$jid</span><span style="color: #007700">));
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Location:admin.php"</span><span style="color: #007700">);
<br />}
<br />
<br />if(</span><span style="color: #0000BB">$mode</span><span style="color: #007700">==</span><span style="color: #DD0000">"muokkaa"</span><span style="color: #007700">)&nbsp;{
<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"otsikko"</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;!empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"kpl"</span><span style="color: #007700">]))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$lisayspvm&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">'Y-m-j'</span><span style="color: #007700">);
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$otsikko&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'otsikko'</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$otsikko&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">putsaa</span><span style="color: #007700">(</span><span style="color: #0000BB">$otsikko</span><span style="color: #007700">);
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kpl&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'kpl'</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kpl&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">putsaa</span><span style="color: #007700">(</span><span style="color: #0000BB">$kpl</span><span style="color: #007700">);
<br />
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'poistamispvm'</span><span style="color: #007700">]))&nbsp;</span><span style="color: #0000BB">$poistamispvm</span><span style="color: #007700">=</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'poistamispvm'</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$poistamispvm&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #0000BB">$lisayspvm</span><span style="color: #007700">)&nbsp;+&nbsp;(</span><span style="color: #0000BB">14&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">24&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">60&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">60</span><span style="color: #007700">);</span><span style="color: #FF8000">//14&nbsp;päivää&nbsp;sekunteina
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$poistamispvm&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">'Y-m-j'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$poistamispvm</span><span style="color: #007700">);
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
<br />
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kid</span><span style="color: #007700">=</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">"kid"</span><span style="color: #007700">];
<br />
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"UPDATE&nbsp;juttu&nbsp;set&nbsp;otsikko=:otsikko,kpl=:kpl,poistamispvm=:poistamispvm,lisayspvm=:lisayspvm,kid=:kid&nbsp;WHERE&nbsp;jid=:jid"</span><span style="color: #007700">;
<br />
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kysely&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$yhteys</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kysely</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(array(</span><span style="color: #DD0000">":otsikko"</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$otsikko</span><span style="color: #007700">,</span><span style="color: #DD0000">":kpl"</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$kpl</span><span style="color: #007700">,</span><span style="color: #DD0000">":poistamispvm"</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$poistamispvm</span><span style="color: #007700">,</span><span style="color: #DD0000">"lisayspvm"</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$lisayspvm</span><span style="color: #007700">,</span><span style="color: #DD0000">":kid"</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$kid</span><span style="color: #007700">,</span><span style="color: #DD0000">":jid"</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$jid</span><span style="color: #007700">));
<br />
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$kysely</span><span style="color: #007700">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Tiedot&nbsp;muutettu!&lt;br&gt;"</span><span style="color: #007700">;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;a&nbsp;href=\"admin.php\"&gt;Palaa&nbsp;juttuluetteloon.&lt;/a&gt;&lt;br&gt;"</span><span style="color: #007700">;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
<br />&nbsp;&nbsp;&nbsp;&nbsp;}
<br />&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{
<br />
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/********************************************************************
<br />&nbsp;&nbsp;&nbsp;&nbsp;Jos&nbsp;tietoja&nbsp;puuttuu&nbsp;tai&nbsp;tullaan&nbsp;ensimmäistä&nbsp;kertaa&nbsp;sovellukseen,
<br />&nbsp;&nbsp;&nbsp;&nbsp;tulostetaan&nbsp;lomake&nbsp;(valmiit&nbsp;tiedot&nbsp;lomakkeeseen).&nbsp;Jos&nbsp;tietoja&nbsp;puuttuu
<br />&nbsp;&nbsp;&nbsp;&nbsp;tulostetaan&nbsp;niistä&nbsp;ilmoitus
<br />&nbsp;&nbsp;&nbsp;&nbsp;********************************************************************/
<br />
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"Täytä&nbsp;lomake&nbsp;kokonaan,&nbsp;pakolliset&nbsp;kentät&nbsp;on&nbsp;merkitty&nbsp;tähdellä."</span><span style="color: #007700">;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">))&nbsp;{
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'otsikko'</span><span style="color: #007700">]))&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Kirjoita&nbsp;otsikko"</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;&nbsp;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'kpl'</span><span style="color: #007700">]))&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Kirjoita&nbsp;itse&nbsp;juttu"</span><span style="color: #007700">;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sql</span><span style="color: #007700">=</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;juttu&nbsp;WHERE&nbsp;jid=?"</span><span style="color: #007700">;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kysely&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$yhteys</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kysely</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(array(</span><span style="color: #0000BB">$jid</span><span style="color: #007700">));
<br />
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$rivi&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$kysely</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">);&nbsp;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">$rivi</span><span style="color: #007700">)&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Juttua&nbsp;ei&nbsp;löydy&nbsp;"</span><span style="color: #007700">;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$jid</span><span style="color: #007700">=</span><span style="color: #0000BB">$rivi</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">"jid"</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$lisayspvm</span><span style="color: #007700">=</span><span style="color: #0000BB">$rivi</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">"lisayspvm"</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$poistamispvm</span><span style="color: #007700">=</span><span style="color: #0000BB">$rivi</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">"poistamispvm"</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$otsikko</span><span style="color: #007700">=</span><span style="color: #0000BB">$rivi</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">"otsikko"</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kpl</span><span style="color: #007700">=</span><span style="color: #0000BB">$rivi</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">"kpl"</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kid</span><span style="color: #007700">=</span><span style="color: #0000BB">$rivi</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">"kid"</span><span style="color: #007700">];
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">?&gt;
<br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;form&nbsp;action="./admin.php?sivu=muokkaa_juttua&amp;mode=muokkaa&amp;jid=<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$jid</span><span style="color: #007700">;</span><span style="color: #0000BB">?&gt;</span>"&nbsp;method="post"&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;label&nbsp;for="otsikko"&gt;*&nbsp;Otsikko&lt;/label&gt;&lt;br&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="text"&nbsp;name="otsikko"&nbsp;value="<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">if(isset(</span><span style="color: #0000BB">$otsikko</span><span style="color: #007700">))&nbsp;echo&nbsp;</span><span style="color: #0000BB">$otsikko</span><span style="color: #007700">;</span><span style="color: #0000BB">?&gt;</span>"&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;
<br />
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;label&nbsp;for="otsikko"&gt;*&nbsp;Teksti&lt;/label&gt;&lt;br&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;textarea&nbsp;name="kpl"&nbsp;cols="45"&nbsp;rows="5"&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">if(isset(</span><span style="color: #0000BB">$kpl</span><span style="color: #007700">))&nbsp;echo&nbsp;</span><span style="color: #0000BB">$kpl?&gt;</span>&lt;/textarea&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;
<br />
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;label&nbsp;for="otsikko"&gt;Poistamispvm&nbsp;(jos&nbsp;et&nbsp;aseta&nbsp;päiväystä,&nbsp;poistuu&nbsp;automaattisesti&nbsp;kahden&nbsp;viikon&nbsp;kuluttua)&lt;/label&gt;&lt;br&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="text"&nbsp;id="pvm1"&nbsp;name="poistamispvm"&nbsp;value="<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">if(isset(</span><span style="color: #0000BB">$poistamispvm</span><span style="color: #007700">))&nbsp;echo&nbsp;</span><span style="color: #0000BB">$poistamispvm</span><span style="color: #007700">;</span><span style="color: #0000BB">?&gt;</span>"&gt;&lt;br&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href="javascript:NewCal('pvm1','mmddyyyy','','')"&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;img&nbsp;class="kuvake"&nbsp;src="./tyyli/kuvat/cal.gif"&nbsp;width="16"&nbsp;height="16"&nbsp;border="0"&nbsp;alt="Klikkaa&nbsp;valitaksesi&nbsp;päivämäärä"&gt;&lt;/a&gt;&lt;br&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Huom.&nbsp;Kirjoitettaessa&nbsp;esitysmuoto&nbsp;vvvv-kk-pv&nbsp;&lt;/p&gt;
<br />
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;class="button"&nbsp;type="submit"&nbsp;value="Muokkaa&nbsp;juttua"&nbsp;name="painike"&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/form&gt;
<br />
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000BB">&lt;?php
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}
<br />}
<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></p>



<h3>./sisalto/muokkaa_omia_tietoja.php</h3>
<p> Tiedosto hakee vanhat käyttäjän tiedot lomakkeelle ja submit-painikkeen painamisen jälkeen lähettää ne palvelimelle. Tietojen oikeellisuus tarkistetaan ja jos kaikki on kunnossa, päivitetään tietokantaan. Salasana on asetettu istuntoon jo kirjautumista tarkistettaessa (sen toki voi laittaa istunomuuttujaan talteen myös samaan aikaan, kun lomake tulostetaan kuvaruudulle).<br>
Jotta käyttäjän tietoja voi muuttaa, tarvitaan käyttäjäid, jonka saa myös istunnosta.</p>

<p class="koodi">
<code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;Tiedosto&nbsp;hakee&nbsp;vanhat&nbsp;käyttäjän&nbsp;tiedot&nbsp;lomakkeelle&nbsp;ja&nbsp;submit-painikkeen&nbsp;painamisen&nbsp;jälkeen&nbsp;lähettää&nbsp;ne&nbsp;palvelimelle.&nbsp;Tietojen&nbsp;oikeellisuus&nbsp;tarkistetaan&nbsp;ja&nbsp;jos&nbsp;kaikki&nbsp;on&nbsp;kunnossa,&nbsp;päivitetään&nbsp;tietokantaan.&nbsp;*&nbsp;Jotta&nbsp;käyttäjän&nbsp;tietoja&nbsp;voi&nbsp;muuttaa,&nbsp;tarvitaan&nbsp;käyttäjäid,&nbsp;jonka&nbsp;saa&nbsp;istunnosta.&nbsp;<br />Taulun&nbsp;kentät<br />*&nbsp;kid&nbsp;int(6)&nbsp;auto_increment&nbsp;(on&nbsp;siis&nbsp;autonumber&nbsp;tai&nbsp;laskuri-tyyppinen)<br />*&nbsp;sukunimi&nbsp;varchar(30)<br />*&nbsp;etunimi&nbsp;varchar(30)<br />*&nbsp;ktunnus&nbsp;varchar(30)<br />*&nbsp;salasana&nbsp;varchar(100)<br />*/<br /></span><span style="color: #007700">require&nbsp;</span><span style="color: #DD0000">"./tietokanta/yhteys.php"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$kid</span><span style="color: #007700">=</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">"kid"</span><span style="color: #007700">];</span><span style="color: #FF8000">//hakee&nbsp;kirjautumisen&nbsp;kohdalla&nbsp;luodusta&nbsp;istuntomuuttujasta&nbsp;kirjautuneen&nbsp;käyttäjän&nbsp;kid:n<br /><br /><br /></span><span style="color: #007700">if(isset(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">"mode"</span><span style="color: #007700">]))&nbsp;</span><span style="color: #0000BB">$mode</span><span style="color: #007700">=</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">"mode"</span><span style="color: #007700">];<br />else&nbsp;</span><span style="color: #0000BB">$mode</span><span style="color: #007700">=</span><span style="color: #DD0000">"muokkaa"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">/*********************************************************************/<br /></span><span style="color: #0000BB">$istuntosalasana</span><span style="color: #007700">=</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">"salasana"</span><span style="color: #007700">];</span><span style="color: #FF8000">//otetaan&nbsp;muuttujaan&nbsp;salasana,&nbsp;joka&nbsp;käyttäjällä&nbsp;on&nbsp;kirjautuessa<br /></span><span style="color: #0000BB">$tiedotok</span><span style="color: #007700">=</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />if(!empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"etunimi"</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;!empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"sukunimi"</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;!empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"ktunnus"</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;!empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"vanhasalasana"</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">muunna_salasana</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"vanhasalasana"</span><span style="color: #007700">])==&nbsp;</span><span style="color: #0000BB">$istuntosalasana</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//otetaan&nbsp;lähetetyt&nbsp;tiedot&nbsp;muuttujiin<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$etunimi</span><span style="color: #007700">=</span><span style="color: #0000BB">putsaa</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"etunimi"</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sukunimi</span><span style="color: #007700">=</span><span style="color: #0000BB">putsaa</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"sukunimi"</span><span style="color: #007700">]);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tiedotok</span><span style="color: #007700">=</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//haetaan&nbsp;uudet&nbsp;salasanat&nbsp;ja&nbsp;tarkistetaan,&nbsp;että&nbsp;ne&nbsp;ovat&nbsp;samat.&nbsp;Jos&nbsp;ovat&nbsp;samat,&nbsp;otetaan&nbsp;uusi&nbsp;salasana&nbsp;muuttujaan&nbsp;$salasana<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"salasana"</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;!empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"tokasalasana"</span><span style="color: #007700">]))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">putsaa</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"salasana"</span><span style="color: #007700">])&nbsp;==&nbsp;</span><span style="color: #0000BB">putsaa</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"tokasalasana"</span><span style="color: #007700">]))&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$salasana</span><span style="color: #007700">=</span><span style="color: #0000BB">muunna_salasana</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"salasana"</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;jos&nbsp;eivät&nbsp;ole&nbsp;samat,&nbsp;mitään&nbsp;muutoksia&nbsp;ei&nbsp;tehdä<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tiedotok</span><span style="color: #007700">=</span><span style="color: #0000BB">FALSE</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Uudet&nbsp;salasanat&nbsp;eivät&nbsp;vastaa&nbsp;toisiaan,&nbsp;muutoksia&nbsp;ei&nbsp;tehdä!&lt;br&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//jos&nbsp;ei&nbsp;annettu,&nbsp;salasana&nbsp;napataan&nbsp;istunnosta&nbsp;eli&nbsp;vanha&nbsp;salasana&nbsp;jää&nbsp;voimaan<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">else&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$salasana&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$istuntosalasana</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;salasanasuojataan&nbsp;lomakkeella&nbsp;annettu&nbsp;vanha&nbsp;salasana<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$vanhasalasana</span><span style="color: #007700">=</span><span style="color: #0000BB">muunna_salasana</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"vanhasalasana"</span><span style="color: #007700">]);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//jos&nbsp;annettu&nbsp;vanha&nbsp;ei&nbsp;vastaa&nbsp;istunnossa&nbsp;olevaa&nbsp;salasanaa,&nbsp;muutosta&nbsp;ei&nbsp;tehdä<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$istuntosalasana</span><span style="color: #007700">!=</span><span style="color: #0000BB">$vanhasalasana</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tiedotok</span><span style="color: #007700">=</span><span style="color: #0000BB">FALSE</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Anna&nbsp;alkuperäinen&nbsp;salasana&nbsp;oikein!&lt;br&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$tiedotok</span><span style="color: #007700">==</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//rakennetaan&nbsp;sql-lause<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sql</span><span style="color: #007700">=</span><span style="color: #DD0000">"UPDATE&nbsp;kayttaja&nbsp;SET&nbsp;etunimi=:etunimi,sukunimi=:sukunimi,salasana=:salasana&nbsp;WHERE&nbsp;kid=:kid;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kysely</span><span style="color: #007700">=</span><span style="color: #0000BB">$yhteys</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kysely</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(array(</span><span style="color: #DD0000">":etunimi"</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$etunimi</span><span style="color: #007700">,</span><span style="color: #DD0000">":sukunimi"</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$sukunimi</span><span style="color: #007700">,</span><span style="color: #DD0000">":salasana"</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$salasana</span><span style="color: #007700">,</span><span style="color: #DD0000">":kid"</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$kid</span><span style="color: #007700">));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$kysely</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Tiedot&nbsp;muutettu"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tiedotok</span><span style="color: #007700">=</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">"salasana"</span><span style="color: #007700">]=</span><span style="color: #0000BB">$salasana</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//vaihdetaan&nbsp;istunnon&nbsp;salasanaa<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}&nbsp;<br /><br /></span><span style="color: #FF8000">//jos&nbsp;tietoja&nbsp;puuttuu&nbsp;tai&nbsp;ei&nbsp;ole&nbsp;lähetetty&nbsp;lomaketta,&nbsp;haetaan&nbsp;olemassaolevat&nbsp;tiedot&nbsp;kannasta<br /></span><span style="color: #007700">if(</span><span style="color: #0000BB">$tiedotok</span><span style="color: #007700">==</span><span style="color: #0000BB">false</span><span style="color: #007700">){<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sql</span><span style="color: #007700">=</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;kayttaja&nbsp;WHERE&nbsp;kid='</span><span style="color: #0000BB">$kid</span><span style="color: #DD0000">'"</span><span style="color: #007700">;</span><span style="color: #FF8000">//huom,&nbsp;tieto&nbsp;istunnosta,&nbsp;ei&nbsp;vaarallinen<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$kysely</span><span style="color: #007700">=</span><span style="color: #0000BB">$yhteys</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">$kysely</span><span style="color: #007700">)&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Käyttäjää&nbsp;ei&nbsp;löydy."</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span style="color: #FF8000">//arvot&nbsp;kannasta&nbsp;muuttujiin&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$rivi&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$kysely</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$etunimi</span><span style="color: #007700">=</span><span style="color: #0000BB">$rivi</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">"etunimi"</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sukunimi</span><span style="color: #007700">=</span><span style="color: #0000BB">$rivi</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">"sukunimi"</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ktunnus</span><span style="color: #007700">=</span><span style="color: #0000BB">$rivi</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">"ktunnus"</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$salasana</span><span style="color: #007700">=</span><span style="color: #0000BB">$rivi</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">"salasana"</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /></span><span style="color: #0000BB">?&gt;<br /></span><br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;form&nbsp;action="admin.php?sivu=muokkaa_omia_tietoja&amp;mode=muokkaa&amp;kid=<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$kid</span><span style="color: #007700">;</span><span style="color: #0000BB">?&gt;</span>"&nbsp;method="post"&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;label&nbsp;for="ktunnus"&gt;*&nbsp;Käyttäjätunnus&nbsp;&lt;/label&gt;&lt;br&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">if(isset(</span><span style="color: #0000BB">$ktunnus</span><span style="color: #007700">))&nbsp;echo&nbsp;</span><span style="color: #0000BB">$ktunnus</span><span style="color: #007700">;</span><span style="color: #FF8000">//näyttää&nbsp;ktunnus&nbsp;arvon;</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="hidden"&nbsp;name="ktunnus"&nbsp;value="<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">if(isset(</span><span style="color: #0000BB">$ktunnus</span><span style="color: #007700">))&nbsp;echo&nbsp;</span><span style="color: #0000BB">$ktunnus</span><span style="color: #007700">;</span><span style="color: #FF8000">//piilokenttä,&nbsp;ei&nbsp;näy,&nbsp;mutta&nbsp;siirtyy&nbsp;</span><span style="color: #0000BB">?&gt;</span>"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;label&nbsp;for="etunimi"&gt;*&nbsp;Etunimi&nbsp;&lt;/label&gt;&lt;br&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="text"&nbsp;name="etunimi"&nbsp;value="<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">if(isset(</span><span style="color: #0000BB">$etunimi</span><span style="color: #007700">))&nbsp;echo&nbsp;</span><span style="color: #0000BB">$etunimi</span><span style="color: #007700">;</span><span style="color: #0000BB">?&gt;</span>"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;label&nbsp;for="sukunimi"&gt;*&nbsp;Sukunimi&nbsp;&lt;/label&gt;&lt;br&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="text"&nbsp;name="sukunimi"&nbsp;value="<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">if(isset(</span><span style="color: #0000BB">$sukunimi</span><span style="color: #007700">))&nbsp;echo&nbsp;</span><span style="color: #0000BB">$sukunimi</span><span style="color: #007700">;</span><span style="color: #0000BB">?&gt;</span>"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&nbsp;&nbsp;&nbsp;&nbsp;Salasanan&nbsp;muutos&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;label&nbsp;for="salasana"&gt;Uusi&nbsp;salasana&nbsp;&lt;/label&gt;&lt;br&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="password"&nbsp;name="salasana"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;label&nbsp;for="tokasalasana"&gt;Uusi&nbsp;salasana&nbsp;uudelleen&nbsp;&lt;/label&gt;&lt;br&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="password"&nbsp;name="tokasalasana"?&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;label&nbsp;for="vanhasalasana"&gt;*&nbsp;Vanha&nbsp;salasana&nbsp;(pakollinen&nbsp;kaikissa&nbsp;muutoksissa)&lt;/label&gt;&lt;br&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="password"&nbsp;name="vanhasalasana"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;class="button"&nbsp;type="submit"&nbsp;value="Muuta&nbsp;tiedot"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/form&gt;<br /><br /><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></p>

</div>

<script type="text/javascript" src="footer.js"> </script>